<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö—É–ø–∏–∫–∞ ‚Äî –°–ø–∏—Å–∫–∏ –ø–æ–∫—É–ø–æ–∫</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=JetBrains+Mono:wght@700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #0f1117;
      --bg2: #181b24;
      --bg3: #1f2330;
      --card: #252a38;
      --border: #2e3447;
      --accent: #4ade80;
      --accent2: #22d3ee;
      --warn: #fb923c;
      --text: #e8eaf0;
      --text2: #8892a4;
      --text3: #535d72;
      --r: 16px;
      --rs: 10px;
      --sh: 0 4px 24px rgba(0, 0, 0, .4);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .hdr {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15, 17, 23, .88);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      height: 60px;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-size: 22px;
      font-weight: 900;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hdr-nav {
      display: flex;
      gap: 4px;
    }

    .nav-btn {
      background: none;
      border: none;
      color: var(--text2);
      padding: 8px 14px;
      border-radius: var(--rs);
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: .2s;
    }

    .nav-btn:hover,
    .nav-btn.active {
      color: var(--text);
      background: var(--bg3);
    }

    .nav-btn.active {
      color: var(--accent);
    }

    .main {
      flex: 1;
      padding: 24px 20px 100px;
      max-width: 640px;
      margin: 0 auto;
      width: 100%;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--sh);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      padding: 12px 20px;
      border-radius: var(--rs);
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      transition: .18s;
      text-decoration: none;
      line-height: 1;
    }

    .btn-primary {
      background: var(--accent);
      color: #071a0e;
    }

    .btn-primary:hover {
      background: #86efac;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg3);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--accent2);
      color: var(--accent2);
    }

    .btn-danger {
      background: rgba(239, 68, 68, .13);
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, .25);
    }

    .btn-danger:hover {
      background: rgba(239, 68, 68, .22);
    }

    .btn-ghost {
      background: none;
      color: var(--text2);
    }

    .btn-ghost:hover {
      color: var(--text);
      background: var(--bg3);
    }

    .btn-wa {
      background: #25d366;
      color: #fff;
    }

    .btn-wa:hover {
      background: #22c55e;
      transform: translateY(-1px);
    }

    .btn-sm {
      padding: 7px 12px;
      font-size: 13px;
    }

    .btn-icon {
      padding: 8px;
      border-radius: 8px;
    }

    .btn-full {
      width: 100%;
    }

    .btn:disabled {
      opacity: .38;
      cursor: not-allowed;
      transform: none !important;
    }

    .inp {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: var(--rs);
      color: var(--text);
      font-family: inherit;
      font-size: 15px;
      outline: none;
      transition: .18s;
    }

    .inp:focus {
      border-color: var(--accent);
    }

    .inp::placeholder {
      color: var(--text3);
    }

    select.inp {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238892a4' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 36px;
    }

    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }

    .badge-green {
      background: rgba(74, 222, 128, .14);
      color: var(--accent);
    }

    .badge-blue {
      background: rgba(34, 211, 238, .14);
      color: var(--accent2);
    }

    .badge-orange {
      background: rgba(251, 146, 60, .14);
      color: var(--warn);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .chip {
      padding: 6px 14px;
      border-radius: 20px;
      background: var(--bg3);
      border: 1px solid var(--border);
      font-size: 13px;
      font-weight: 600;
      color: var(--text2);
      cursor: pointer;
      transition: .18s;
      font-family: inherit;
    }

    .chip:hover,
    .chip.active {
      background: rgba(74, 222, 128, .1);
      border-color: var(--accent);
      color: var(--accent);
    }

    .list-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 18px 20px;
      cursor: pointer;
      transition: .18s;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .list-card:hover {
      border-color: var(--accent2);
      transform: translateY(-1px);
      box-shadow: var(--sh);
    }

    .list-card h3 {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 6px;
    }

    .list-card-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
      transition: .2s;
    }

    .item:last-child {
      border-bottom: none;
    }

    .item.done {
      opacity: .42;
    }

    .item.done .item-name {
      text-decoration: line-through;
      color: var(--text3);
    }

    .item-check {
      width: 24px;
      height: 24px;
      border-radius: 8px;
      border: 2px solid var(--border);
      background: none;
      cursor: pointer;
      flex-shrink: 0;
      transition: .15s;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    .item-check.checked {
      background: var(--accent);
      border-color: var(--accent);
    }

    .item-body {
      flex: 1;
      min-width: 0;
    }

    .item-name {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .item-meta {
      font-size: 13px;
      color: var(--text2);
    }

    .item-price {
      font-size: 15px;
      font-weight: 800;
      color: var(--accent);
      white-space: nowrap;
      font-family: 'JetBrains Mono', monospace;
    }

    .item-del {
      opacity: 0;
      transition: .18s;
    }

    .item:hover .item-del {
      opacity: 1;
    }

    .total-bar {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .total-lbl {
      font-size: 14px;
      color: var(--text2);
      font-weight: 600;
    }

    .total-amt {
      font-size: 22px;
      font-weight: 900;
      color: var(--accent);
      font-family: 'JetBrains Mono', monospace;
    }

    .prog {
      height: 4px;
      background: var(--border);
      border-radius: 4px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .prog-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius: 4px;
      transition: width .4s ease;
    }

    .scanner-ov {
      position: fixed;
      inset: 0;
      z-index: 200;
      background: rgba(0, 0, 0, .97);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    .scanner-frame {
      position: relative;
      width: 280px;
      height: 280px;
    }

    #scan-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 16px;
      display: block;
    }

    .scan-corner {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .scan-corner::before,
    .scan-corner::after,
    .scan-corner span::before,
    .scan-corner span::after {
      content: '';
      position: absolute;
      width: 28px;
      height: 28px;
      border-color: var(--accent);
      border-style: solid;
    }

    .scan-corner::before {
      top: 0;
      left: 0;
      border-width: 3px 0 0 3px;
      border-radius: 8px 0 0 0;
    }

    .scan-corner::after {
      top: 0;
      right: 0;
      border-width: 3px 3px 0 0;
      border-radius: 0 8px 0 0;
    }

    .scan-corner span::before {
      bottom: 0;
      left: 0;
      border-width: 0 0 3px 3px;
      border-radius: 0 0 0 8px;
    }

    .scan-corner span::after {
      bottom: 0;
      right: 0;
      border-width: 0 3px 3px 0;
      border-radius: 0 0 8px 0;
    }

    .scan-line {
      position: absolute;
      left: 5%;
      width: 90%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      animation: scan 2s ease-in-out infinite;
    }

    @keyframes scan {

      0%,
      100% {
        top: 10%;
      }

      50% {
        top: 85%;
      }
    }

    .scan-hint {
      color: var(--text2);
      font-size: 15px;
      text-align: center;
      padding: 0 20px;
    }

    .modal-ov {
      position: fixed;
      inset: 0;
      z-index: 150;
      background: rgba(0, 0, 0, .72);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .modal {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 24px 24px 0 0;
      padding: 24px 20px 32px;
      width: 100%;
      max-width: 640px;
      animation: slide-up .28s ease;
    }

    @keyframes slide-up {
      from {
        transform: translateY(100%);
      }

      to {
        transform: translateY(0);
      }
    }

    .modal-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 20px;
    }

    .form-row {
      margin-bottom: 14px;
    }

    .form-lbl {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text3);
      margin-bottom: 6px;
      display: block;
    }

    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 14px;
    }

    .toast-wrap {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      pointer-events: none;
    }

    .toast {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 11px 20px;
      font-size: 14px;
      font-weight: 700;
      box-shadow: var(--sh);
      white-space: nowrap;
      animation: toast-in .25s ease;
    }

    .toast.ok {
      border-color: var(--accent);
      color: var(--accent);
    }

    .toast.err {
      border-color: #f87171;
      color: #f87171;
    }

    @keyframes toast-in {
      from {
        opacity: 0;
        transform: translateY(12px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .bnav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 17, 23, .96);
      backdrop-filter: blur(16px);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      height: 64px;
      z-index: 99;
    }

    .bnav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text3);
      font-family: inherit;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .5px;
      text-transform: uppercase;
      padding: 8px 20px;
      transition: .18s;
      flex: 1;
    }

    .bnav-btn.active {
      color: var(--accent);
    }

    .bnav-icon {
      font-size: 21px;
      line-height: 1;
    }

    .fab {
      position: fixed;
      bottom: 76px;
      right: 20px;
      width: 54px;
      height: 54px;
      border-radius: 17px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none;
      cursor: pointer;
      font-size: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 24px rgba(74, 222, 128, .32);
      transition: .18s;
      z-index: 98;
    }

    .fab:hover {
      transform: scale(1.08);
    }

    .empty {
      text-align: center;
      padding: 52px 20px;
      color: var(--text3);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 14px;
    }

    .empty h3 {
      font-size: 18px;
      font-weight: 800;
      color: var(--text2);
      margin-bottom: 8px;
    }

    .empty p {
      font-size: 14px;
      line-height: 1.6;
    }

    .hero {
      text-align: center;
      padding: 36px 20px 28px;
    }

    .hero h1 {
      font-size: 30px;
      font-weight: 900;
      line-height: 1.2;
      margin-bottom: 10px;
    }

    .hero h1 span {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero p {
      color: var(--text2);
      font-size: 15px;
      line-height: 1.6;
    }

    .spin {
      width: 36px;
      height: 36px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spinning .7s linear infinite;
      margin: 60px auto;
    }

    @keyframes spinning {
      to {
        transform: rotate(360deg);
      }
    }

    .ps h2 {
      font-size: 18px;
      font-weight: 900;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .ps p {
      font-size: 15px;
      color: var(--text2);
      line-height: 1.7;
    }

    .ps+.ps {
      margin-top: 20px;
    }

    .contact-row {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }

    .contact-row:last-child {
      border-bottom: none;
    }

    .contact-icon {
      font-size: 22px;
      width: 32px;
      text-align: center;
    }

    .contact-lbl {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text3);
      margin-bottom: 4px;
    }

    .contact-val a {
      color: var(--accent2);
      text-decoration: none;
      font-weight: 700;
    }

    .contact-val a:hover {
      text-decoration: underline;
    }

    .cat-hdr {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text3);
      padding: 14px 0 4px;
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 16px 0;
    }

    @media(min-width:640px) {
      .bnav {
        display: none;
      }

      .fab {
        bottom: 24px;
      }

      .toast-wrap {
        bottom: 24px;
      }

      .main {
        padding-bottom: 40px;
      }
    }

    @media(max-width:639px) {
      .hdr-nav {
        display: none;
      }
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
    }
  </style>
</head>

<body>
  <div id="app">
    <div style="display:flex;align-items:center;justify-content:center;height:100vh;">
      <div class="spin"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp }
      from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"
    import {
      getFirestore, collection, query, where, orderBy,
      onSnapshot, addDoc, updateDoc, deleteDoc, doc, serverTimestamp
    }
      from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"
    import { getAuth, signInAnonymously, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js"

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ‚ö†Ô∏è –í–°–¢–ê–í–¨–¢–ï –°–í–û–ô CONFIG (Firebase Console ‚Üí Project Settings ‚Üí General)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const firebaseConfig = {
      apiKey: "AIzaSyDgJPFULJSK9_V__2OcTbKY8ZrRzUz8mCE",
      authDomain: "kupika-e33ef.firebaseapp.com",
      projectId: "kupika-e33ef",
      storageBucket: "kupika-e33ef.firebasestorage.app",
      messagingSenderId: "153054761187",
      appId: "1:153054761187:web:d94088d86e1c404965f5d6"
    }

    const fbApp = initializeApp(firebaseConfig)
    const db = getFirestore(fbApp)
    const auth = getAuth(fbApp)

    // ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const CATS = [
      { id: 'produce', label: 'ü•¶ –û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã' },
      { id: 'dairy', label: 'ü•õ –ú–æ–ª–æ—á–Ω–æ–µ' },
      { id: 'meat', label: 'ü•© –ú—è—Å–æ –∏ —Ä—ã–±–∞' },
      { id: 'bakery', label: 'üçû –•–ª–µ–± / –≤—ã–ø–µ—á–∫–∞' },
      { id: 'drinks', label: 'ü•§ –ù–∞–ø–∏—Ç–∫–∏' },
      { id: 'other', label: 'üõí –î—Ä—É–≥–æ–µ' },
    ]
    const UNITS = ['—à—Ç.', '–∫–≥', '–≥', '–ª', '–º–ª', '—É–ø.', '–±—É—Ç.', '–ø–∞—á.']

    // ‚îÄ‚îÄ DOM HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const genId = () => Math.random().toString(36).slice(2) + Date.now().toString(36)
    function h(tag, props, ...kids) {
      const el = document.createElement(tag)
      for (const [k, v] of Object.entries(props || {})) {
        if (k === 'className') el.className = v
        else if (k === 'style' && typeof v === 'string') el.style.cssText = v
        else if (k.startsWith('on')) el.addEventListener(k.slice(2).toLowerCase(), v)
        else el.setAttribute(k, v)
      }
      for (const c of kids.flat()) {
        if (c == null || c === false) continue
        el.append(typeof c === 'string' ? document.createTextNode(c) : c)
      }
      return el
    }

    // ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const toastWrap = h('div', { className: 'toast-wrap' })
    document.body.appendChild(toastWrap)
    function toast(msg, type = 'ok') {
      const t = h('div', { className: `toast ${type}` }, msg)
      toastWrap.prepend(t)
      setTimeout(() => t.remove(), 2800)
    }

    // ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let _modal = null
    function openModal(nodes) {
      closeModal()
      const ov = h('div', { className: 'modal-ov', onClick: e => { if (e.target === ov) closeModal() } })
      ov.appendChild(h('div', { className: 'modal' }, ...nodes))
      document.body.appendChild(ov)
      _modal = ov
    }
    function closeModal() { if (_modal) { _modal.remove(); _modal = null } }

    // ‚îÄ‚îÄ SVG ICONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function svg(paths) {
      const s = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
      s.setAttribute('width', '18'); s.setAttribute('height', '18')
      s.setAttribute('viewBox', '0 0 24 24'); s.setAttribute('fill', 'none')
      s.setAttribute('stroke', 'currentColor'); s.setAttribute('stroke-width', '2')
      s.setAttribute('stroke-linecap', 'round'); s.setAttribute('stroke-linejoin', 'round')
      s.innerHTML = paths
      return s
    }
    const icoTrash = () => svg('<polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/>')
    const icoBack = () => svg('<path d="M19 12H5M12 5l-7 7 7 7"/>')
    const icoScan = () => svg('<rect x="3" y="3" width="5" height="5"/><rect x="16" y="3" width="5" height="5"/><rect x="3" y="16" width="5" height="5"/><line x1="21" y1="16" x2="21" y2="21"/><line x1="16" y1="21" x2="21" y2="21"/><line x1="12" y1="3" x2="12" y2="8"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="12" y1="16" x2="12" y2="21"/>')
    function icoWA() {
      const s = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
      s.setAttribute('width', '18'); s.setAttribute('height', '18')
      s.setAttribute('viewBox', '0 0 24 24'); s.setAttribute('fill', 'currentColor')
      s.innerHTML = '<path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.106.549 4.09 1.51 5.816L.057 24l6.304-1.654A11.94 11.94 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.818a9.835 9.835 0 01-5.012-1.373l-.36-.214-3.738.98 1.001-3.647-.235-.374A9.834 9.834 0 012.149 12C2.149 6.56 6.56 2.149 12 2.149S21.851 6.56 21.851 12c0 5.44-4.411 9.818-9.851 9.818z"/>'
      return s
    }
    const chkSvg = '<svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 6L5 9L10 3" stroke="#071a0e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'

    // ‚îÄ‚îÄ BARCODE SCANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let scanStream = null
    async function openScanner(onScan) {
      const video = h('video', { id: 'scan-video', autoplay: '', playsinline: '', muted: '' })
      const frame = h('div', { className: 'scanner-frame' }, video,
        h('div', { className: 'scan-corner' }, h('span', {})),
        h('div', { className: 'scan-line' })
      )
      const hint = h('p', { className: 'scan-hint' }, '–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —à—Ç—Ä–∏—Ö–∫–æ–¥')
      const cancelBtn = h('button', {
        className: 'btn btn-secondary', type: 'button',
        onClick: () => { stopScanner(); ov.remove() }
      }, '–û—Ç–º–µ–Ω–∞')
      const ov = h('div', { className: 'scanner-ov' }, frame, hint, cancelBtn)
      document.body.appendChild(ov)

      try {
        scanStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        video.srcObject = scanStream
        const html5QrCode = new Html5Qrcode("scan-video")

        html5QrCode.start(
          { facingMode: "environment" },
          {
            fps: 10,
            qrbox: 250
          },
          (decodedText) => {
            stopScanner()
            html5QrCode.stop()
            ov.remove()
            onScan(decodedText)
          },
          (errorMessage) => { }
        ).catch(err => {
          hint.textContent = "–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã"
        })
      } catch (e) {
        hint.textContent = '‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ'
      }
    }
    function stopScanner() {
      if (scanStream) { scanStream.getTracks().forEach(t => t.stop()); scanStream = null }
    }

    // ‚îÄ‚îÄ ADD ITEM MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showAddItemModal(onAdd) {
      const nameInp = h('input', { className: 'inp', placeholder: '–ú–æ–ª–æ–∫–æ, —Ö–ª–µ–±...', type: 'text' })
      const qtyInp = h('input', { className: 'inp', type: 'number', min: '0.01', step: '0.01', value: '1' })
      const unitSel = h('select', { className: 'inp' }, ...UNITS.map(u => h('option', { value: u }, u)))
      const priceInp = h('input', { className: 'inp', type: 'number', min: '0', placeholder: '0', step: '0.01' })
      let selectedCat = 'other'

      const chips = h('div', { className: 'chips' })
      CATS.forEach(c => {
        const chip = h('button', {
          className: 'chip' + (c.id === 'other' ? ' active' : ''), type: 'button',
          onClick: () => {
            chips.querySelectorAll('.chip').forEach(x => x.classList.remove('active'))
            chip.classList.add('active'); selectedCat = c.id
          }
        }, c.label)
        chips.appendChild(chip)
      })

      const scanBtn = h('button', {
        className: 'btn btn-secondary btn-icon', type: 'button', title: '–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —à—Ç—Ä–∏—Ö–∫–æ–¥',
        onClick: () => { closeModal(); openScanner(code => { nameInp.value = code; showAddItemModal(onAdd) }) }
      }, icoScan())

      const addBtn = h('button', {
        className: 'btn btn-primary', style: 'flex:2', type: 'button',
        onClick: () => {
          const name = nameInp.value.trim(); if (!name) { nameInp.focus(); return }
          onAdd({
            id: genId(), name, qty: parseFloat(qtyInp.value) || 1, unit: unitSel.value,
            price: parseFloat(priceInp.value) || 0, category: selectedCat, done: false
          })
          closeModal()
        }
      }, '+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä')

      nameInp.addEventListener('keydown', e => { if (e.key === 'Enter') addBtn.click() })

      openModal([
        h('div', { className: 'modal-title' }, '–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä'),
        h('div', { className: 'form-row' },
          h('label', { className: 'form-lbl' }, '–ù–∞–∑–≤–∞–Ω–∏–µ'),
          h('div', { style: 'display:flex;gap:8px' }, nameInp, scanBtn)
        ),
        h('div', { className: 'grid2' },
          h('div', {}, h('label', { className: 'form-lbl' }, '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'), qtyInp),
          h('div', {}, h('label', { className: 'form-lbl' }, '–ï–¥–∏–Ω–∏—Ü–∞'), unitSel)
        ),
        h('div', { className: 'form-row' }, h('label', { className: 'form-lbl' }, '–¶–µ–Ω–∞ –∑–∞ 1 –µ–¥. (‚ÇΩ)'), priceInp),
        h('div', { className: 'form-row' }, h('label', { className: 'form-lbl' }, '–ö–∞—Ç–µ–≥–æ—Ä–∏—è'), chips),
        h('div', { style: 'display:flex;gap:8px;margin-top:6px' },
          h('button', { className: 'btn btn-secondary', style: 'flex:1', type: 'button', onClick: closeModal }, '–û—Ç–º–µ–Ω–∞'),
          addBtn
        )
      ])
      setTimeout(() => nameInp.focus(), 80)
    }

    // ‚îÄ‚îÄ LIST DETAIL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderListDetail(container, listDoc, onBack) {
      let items = [...(listDoc.items || [])]
      let filterCat = 'all'

      async function save(newItems) {
        items = newItems
        try { await updateDoc(doc(db, 'lists', listDoc.id), { items: newItems }) }
        catch (e) { toast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'err') }
      }

      function render() {
        container.innerHTML = ''
        const total = items.reduce((s, it) => s + (it.price * it.qty), 0)
        const doneCount = items.filter(it => it.done).length
        const pct = items.length ? (doneCount / items.length) * 100 : 0

        // Top bar
        container.appendChild(h('div', { style: 'display:flex;align-items:center;gap:10px;margin-bottom:20px;' },
          h('button', { className: 'btn btn-ghost btn-sm btn-icon', type: 'button', onClick: onBack }, icoBack()),
          h('div', { style: 'flex:1;min-width:0;' },
            h('h2', { style: 'font-size:19px;font-weight:900;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;' }, listDoc.name),
            h('div', { style: 'font-size:13px;color:var(--text2)' }, `${items.length} —Ç–æ–≤. ¬∑ ${doneCount} –∫—É–ø–ª–µ–Ω–æ`)
          ),
          h('div', { style: 'display:flex;gap:6px;flex-shrink:0;' },
            ...(doneCount > 0 ? [h('button', {
              className: 'btn btn-ghost btn-sm', type: 'button',
              onClick: () => save(items.map(it => ({ ...it, done: false }))).then(() => { render(); toast('–°–ø–∏—Å–æ–∫ —Å–±—Ä–æ—à–µ–Ω') })
            }, '‚Ü∫')] : []),
            h('button', { className: 'btn btn-wa btn-sm', type: 'button', onClick: sendWA }, icoWA(), ' –û—Ç–ø—Ä–∞–≤–∏—Ç—å')
          )
        ))

        // Progress
        if (items.length > 0) container.appendChild(h('div', { className: 'prog' }, h('div', { className: 'prog-fill', style: `width:${pct}%` })))

        // Total
        if (total > 0) container.appendChild(h('div', { className: 'total-bar' },
          h('span', { className: 'total-lbl' }, '–ò—Ç–æ–≥–æ –∫ –ø–æ–∫—É–ø–∫–µ'),
          h('span', { className: 'total-amt' }, `${total.toFixed(0)} ‚ÇΩ`)
        ))

        // Category filter
        const usedCats = [...new Set(items.map(it => it.category || 'other'))]
        if (usedCats.length > 1) {
          const chips = h('div', { className: 'chips' })
          const mk = (id, label) => h('button', {
            className: 'chip' + (filterCat === id ? ' active' : ''), type: 'button',
            onClick: () => { filterCat = id; render() }
          }, label)
          chips.appendChild(mk('all', '–í—Å–µ'))
          CATS.filter(c => usedCats.includes(c.id)).forEach(c => chips.appendChild(mk(c.id, c.label)))
          container.appendChild(chips)
        }

        // Items list
        const filtered = filterCat === 'all' ? items : items.filter(it => (it.category || 'other') === filterCat)
        const card = h('div', { className: 'card', style: 'padding:4px 16px;' })

        if (items.length === 0) {
          card.appendChild(h('div', { className: 'empty' },
            h('div', { className: 'empty-icon' }, 'üõí'), h('h3', {}, '–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π'), h('p', {}, '–ù–∞–∂–º–∏—Ç–µ ¬´+¬ª —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä')
          ))
        } else if (filtered.length === 0) {
          card.appendChild(h('div', { className: 'empty', style: 'padding:32px 0' }, h('p', {}, '–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏')))
        } else {
          const groups = {}
          filtered.forEach(it => { const c = it.category || 'other'; if (!groups[c]) groups[c] = []; groups[c].push(it) })
          const multiCat = Object.keys(groups).length > 1
          for (const [catId, catItems] of Object.entries(groups)) {
            if (multiCat) {
              const ci = CATS.find(c => c.id === catId)
              card.appendChild(h('div', { className: 'cat-hdr' }, ci?.label || 'üõí –î—Ä—É–≥–æ–µ'))
            }
            catItems.forEach(item => {
              const chk = h('button', {
                className: 'item-check' + (item.done ? ' checked' : ''), type: 'button',
                onClick: async () => { await save(items.map(it => it.id === item.id ? { ...it, done: !it.done } : it)); render() }
              })
              if (item.done) chk.innerHTML = chkSvg
              const del = h('button', {
                className: 'btn btn-danger btn-icon btn-sm item-del', type: 'button',
                onClick: async () => { await save(items.filter(it => it.id !== item.id)); render() }
              }, icoTrash())
              card.appendChild(h('div', { className: 'item' + (item.done ? ' done' : '') },
                chk,
                h('div', { className: 'item-body' },
                  h('div', { className: 'item-name' }, item.name),
                  h('div', { className: 'item-meta' }, `${item.qty} ${item.unit}${item.price ? ` ¬∑ ${item.price}‚ÇΩ/–µ–¥.` : ''}`)
                ),
                item.price > 0 ? h('div', { className: 'item-price' }, `${(item.price * item.qty).toFixed(0)}‚ÇΩ`) : null,
                del
              ))
            })
          }
        }
        container.appendChild(card)

        // FAB
        container.appendChild(h('button', {
          className: 'fab', type: 'button', title: '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä',
          onClick: () => showAddItemModal(async item => {
            await save([...items, item]); render(); toast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω ‚úì')
          })
        }, '+'))
      }

      function sendWA() {
        const nd = items.filter(it => !it.done)
        const total = items.reduce((s, it) => s + (it.price * it.qty), 0)
        const text = `üõí *${listDoc.name}*\n\n`
          + (nd.length ? nd.map(it => `‚Ä¢ ${it.name} ‚Äî ${it.qty} ${it.unit}${it.price ? ` (${(it.price * it.qty).toFixed(0)}‚ÇΩ)` : ''}`)
            .join('\n') : '(–≤—Å–µ –∫—É–ø–ª–µ–Ω–æ üéâ)')
          + (total > 0 ? `\n\nüí∞ *–ò—Ç–æ–≥–æ: ${total.toFixed(0)}‚ÇΩ*` : '')
        window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank', 'noopener')
      }

      render()
    }

    // ‚îÄ‚îÄ HOME PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderHomePage(container, uid) {
      let lists = []
      let openDoc = null

      function draw() {
        container.innerHTML = ''
        if (openDoc) {
          const live = lists.find(l => l.id === openDoc.id) || openDoc
          renderListDetail(container, live, () => { openDoc = null; draw() })
          return
        }
        container.appendChild(h('div', { className: 'hero' },
          h('h1', {}, '–í–∞—à–∏ ', h('span', {}, '–ø–æ–∫—É–ø–∫–∏')),
          h('p', {}, '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–ø–∏—Å–∫–∏, –æ—Ç–º–µ—á–∞–π—Ç–µ –∫—É–ø–ª–µ–Ω–Ω–æ–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤ WhatsApp')
        ))
        container.appendChild(h('button', {
          className: 'btn btn-primary btn-full',
          style: 'margin-bottom:20px', type: 'button', onClick: showCreate
        }, '+ –°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫'))

        if (!lists.length) {
          container.appendChild(h('div', { className: 'empty' },
            h('div', { className: 'empty-icon' }, 'üìã'), h('h3', {}, '–°–ø–∏—Å–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç'), h('p', {}, '–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫')
          ))
          return
        }

        lists.forEach(list => {
          const total = (list.items || []).reduce((s, it) => s + (it.price * it.qty), 0)
          const done = (list.items || []).filter(it => it.done).length
          const count = (list.items || []).length
          const meta = h('div', { className: 'list-card-meta' })
          meta.appendChild(h('span', { className: 'badge badge-blue' }, `${count} —Ç–æ–≤.`))
          if (done > 0) meta.appendChild(h('span', { className: 'badge badge-green' }, `${done} ‚úì`))
          if (total > 0) meta.appendChild(h('span', { className: 'badge badge-orange' }, `${total.toFixed(0)}‚ÇΩ`))
          const del = h('button', {
            className: 'btn btn-danger btn-icon btn-sm', type: 'button',
            onClick: async e => {
              e.stopPropagation()
              if (!confirm(`–£–¥–∞–ª–∏—Ç—å ¬´${list.name}¬ª?`)) return
              await deleteDoc(doc(db, 'lists', list.id)); toast('–°–ø–∏—Å–æ–∫ —É–¥–∞–ª—ë–Ω')
            }
          }, icoTrash())
          container.appendChild(h('div', { className: 'list-card', onClick: () => { openDoc = list; draw() } },
            h('div', { style: 'flex:1;min-width:0;' }, h('h3', {}, list.name), meta),
            h('div', { style: 'flex-shrink:0;margin-left:12px;' }, del)
          ))
        })
      }

      function showCreate() {
        const inp = h('input', { className: 'inp', placeholder: '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞...', type: 'text' })
        const ok = h('button', {
          className: 'btn btn-primary', style: 'flex:2', type: 'button',
          onClick: async () => {
            const name = inp.value.trim(); if (!name) { inp.focus(); return }
            closeModal()
            try { await addDoc(collection(db, 'lists'), { uid, name, items: [], createdAt: serverTimestamp() }); toast('–°–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω ‚úì') }
            catch (e) { toast('–û—à–∏–±–∫–∞: ' + e.message, 'err') }
          }
        }, '–°–æ–∑–¥–∞—Ç—å')
        inp.addEventListener('keydown', e => { if (e.key === 'Enter') ok.click() })
        openModal([
          h('div', { className: 'modal-title' }, '–ù–æ–≤—ã–π —Å–ø–∏—Å–æ–∫'), inp,
          h('div', { style: 'display:flex;gap:8px;margin-top:16px;' },
            h('button', { className: 'btn btn-secondary', style: 'flex:1', type: 'button', onClick: closeModal }, '–û—Ç–º–µ–Ω–∞'), ok
          )
        ])
        setTimeout(() => inp.focus(), 60)
      }

      const q = query(collection(db, 'lists'), where('uid', '==', uid), orderBy('createdAt', 'desc'))
      const unsub = onSnapshot(q, snap => {
        lists = snap.docs.map(d => ({ id: d.id, ...d.data() }))
        draw()
      }, err => {
        if (err.code === 'failed-precondition') {
          container.innerHTML = ''
          container.appendChild(h('div', { className: 'card' },
            h('p', { style: 'color:var(--warn);font-weight:800;margin-bottom:8px;' }, '‚ö†Ô∏è –ù—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å Firestore'),
            h('p', { style: 'color:var(--text2);font-size:14px;line-height:1.6;' },
              'Firebase Console ‚Üí Firestore ‚Üí Indexes ‚Üí —Å–æ–∑–¥–∞–π—Ç–µ —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å: ',
              h('b', {}, '–∫–æ–ª–ª–µ–∫—Ü–∏—è lists'), ', –ø–æ–ª—è: ', h('b', {}, 'uid ASC'), ' + ', h('b', {}, 'createdAt DESC'), '.')
          ))
        } else { toast(err.message, 'err') }
      })

      return () => unsub()
    }

    // ‚îÄ‚îÄ ABOUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderAbout(c) {
      c.innerHTML = ''
      c.appendChild(h('div', { className: 'hero', style: 'padding-bottom:16px' }, h('h1', {}, '–û ', h('span', {}, '–ö—É–ø–∏–∫–µ')), h('p', {}, '–£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ø–æ—Ö–æ–¥–∞ –≤ –º–∞–≥–∞–∑–∏–Ω')))
      const card = h('div', { className: 'card' })
      card.innerHTML = ''
      card.appendChild(h('div', { className: 'ps' }, h('h2', {}, '–ß—Ç–æ —Ç–∞–∫–æ–µ –ö—É–ø–∏–∫–∞?'), h('p', {}, '–ö—É–ø–∏–∫–∞ ‚Äî —É–¥–æ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –ø–æ–∫—É–ø–æ–∫. –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –æ–±–ª–∞–∫–æ Firebase.')))
      card.appendChild(h('div', { className: 'divider' }))
      card.appendChild(h('div', { className: 'ps' }, h('h2', {}, '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏'), h('p', {}, '–ù–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–∏—Å–∫–æ–≤, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤, –ø–æ–¥—Å—á—ë—Ç —Å—É–º–º—ã, –∑–∞—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π, —Å–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –≤ WhatsApp.')))
      card.appendChild(h('div', { className: 'divider' }))
      card.appendChild(h('div', { className: 'ps' }, h('h2', {}, '–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å'), h('p', {}, '–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–æ –≤ Firebase, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É. –ù–∏–∫–∞–∫–æ–π —Ä–µ–∫–ª–∞–º—ã –∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞.')))
      c.appendChild(card)
    }

    // ‚îÄ‚îÄ CONTACTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderContacts(c) {
      c.innerHTML = ''
      c.appendChild(h('div', { className: 'hero', style: 'padding-bottom:16px' }, h('h1', {}, h('span', {}, '–ö–æ–Ω—Ç–∞–∫—Ç—ã')), h('p', {}, '–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º')))
      const card = h('div', { className: 'card' });
      [['üìß', 'Email', 'info@kupika.app', 'mailto:info@kupika.app'],
      ['üí¨', 'WhatsApp', '+7 900 000-00-00', 'https://wa.me/79000000000'],
      ['üåê', '–°–∞–π—Ç', 'kupika.app', 'https://kupika.app']
      ].forEach(([icon, lbl, val, href]) => {
        card.appendChild(h('div', { className: 'contact-row' },
          h('div', { className: 'contact-icon' }, icon),
          h('div', {}, h('div', { className: 'contact-lbl' }, lbl), h('div', { className: 'contact-val' }, h('a', { href, target: '_blank', rel: 'noopener' }, val)))
        ))
      })
      c.appendChild(card)
    }

    // ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function buildApp(uid) {
      const app = document.getElementById('app')
      app.innerHTML = ''
      let curPage = 'home', cleanup = null

      const NAV = [{ id: 'home', label: '–°–ø–∏—Å–∫–∏' }, { id: 'about', label: '–û –Ω–∞—Å' }, { id: 'contacts', label: '–ö–æ–Ω—Ç–∞–∫—Ç—ã' }]
      const BN = [{ id: 'home', label: '–°–ø–∏—Å–∫–∏', icon: 'üìã' }, { id: 'about', label: '–û –Ω–∞—Å', icon: '‚ÑπÔ∏è' }, { id: 'contacts', label: '–ö–æ–Ω—Ç–∞–∫—Ç—ã', icon: 'üìû' }]

      const hdr = h('header', { className: 'hdr' })
      const logo = h('div', { className: 'logo', onClick: () => go('home') }, '–ö—É–ø–∏–∫–∞')
      const hNav = h('nav', { className: 'hdr-nav' })
      NAV.forEach(n => { const b = h('button', { className: 'nav-btn', id: 'hn' + n.id, type: 'button', onClick: () => go(n.id) }, n.label); hNav.appendChild(b) })
      hdr.append(logo, hNav); app.appendChild(hdr)

      const main = h('main', { className: 'main' }); app.appendChild(main)

      const bnav = h('nav', { className: 'bnav' })
      BN.forEach(n => { const b = h('button', { className: 'bnav-btn', id: 'bn' + n.id, type: 'button', onClick: () => go(n.id) }, h('span', { className: 'bnav-icon' }, n.icon), n.label); bnav.appendChild(b) })
      app.appendChild(bnav)

      function setActive(page) {
        NAV.forEach(n => { const b = document.getElementById('hn' + n.id); if (b) b.className = 'nav-btn' + (page === n.id ? ' active' : '') })
        BN.forEach(n => { const b = document.getElementById('bn' + n.id); if (b) b.className = 'bnav-btn' + (page === n.id ? ' active' : '') })
      }

      function go(page) {
        if (cleanup) { cleanup(); cleanup = null }
        curPage = page; setActive(page); main.innerHTML = ''
        if (page === 'home') cleanup = renderHomePage(main, uid) || null
        else if (page === 'about') renderAbout(main)
        else if (page === 'contacts') renderContacts(main)
      }
      go('home')
    }

    // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    onAuthStateChanged(auth, user => {
      if (user) { buildApp(user.uid) }
      else {
        signInAnonymously(auth).catch(err => {
          document.getElementById('app').innerHTML =
            `<div style="text-align:center;padding:60px 20px;">
          <div style="font-size:48px;margin-bottom:16px;">‚ö†Ô∏è</div>
          <div style="color:#f87171;font-weight:800;font-size:18px;margin-bottom:10px;">–û—à–∏–±–∫–∞ Firebase</div>
          <div style="color:#8892a4;font-size:14px;line-height:1.7;">${err.message}<br><br>
          –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π <b style="color:#e8eaf0">firebaseConfig</b> –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞.</div>
        </div>`
        })
      }
    });
  </script>
  <script src="https://unpkg.com/html5-qrcode"></script>
</body>

</html>